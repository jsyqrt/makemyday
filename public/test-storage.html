<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å­˜å‚¨æµ‹è¯• - Make My Day</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .test-box {
      background: white;
      padding: 20px;
      margin: 20px 0;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    button {
      padding: 10px 20px;
      margin: 5px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      background: #4CAF50;
      color: white;
      font-size: 14px;
    }
    button:hover {
      background: #45a049;
    }
    .danger {
      background: #f44336;
    }
    .danger:hover {
      background: #da190b;
    }
    pre {
      background: #f0f0f0;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
      max-height: 300px;
      overflow-y: auto;
    }
    .status {
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
    }
    .status.success {
      background: #d4edda;
      color: #155724;
    }
    .status.error {
      background: #f8d7da;
      color: #721c24;
    }
    .status.warning {
      background: #fff3cd;
      color: #856404;
    }
  </style>
</head>
<body>
  <h1>ğŸ” Make My Day - å­˜å‚¨è¯Šæ–­å·¥å…·</h1>

  <div class="test-box">
    <h2>1. æµè§ˆå™¨ç¯å¢ƒæ£€æŸ¥</h2>
    <div id="env-status"></div>
  </div>

  <div class="test-box">
    <h2>2. æµ‹è¯• localStorage</h2>
    <button onclick="testLocalStorage()">æµ‹è¯• localStorage</button>
    <button onclick="saveTestData()">ä¿å­˜æµ‹è¯•æ•°æ®</button>
    <button onclick="loadTestData()">åŠ è½½æµ‹è¯•æ•°æ®</button>
    <button class="danger" onclick="clearTestData()">æ¸…é™¤æµ‹è¯•æ•°æ®</button>
    <div id="test-result"></div>
  </div>

  <div class="test-box">
    <h2>3. æŸ¥çœ‹ Make My Day æ•°æ®</h2>
    <button onclick="viewAppData()">æŸ¥çœ‹åº”ç”¨æ•°æ®</button>
    <button class="danger" onclick="clearAppData()">æ¸…é™¤åº”ç”¨æ•°æ®</button>
    <div id="app-data"></div>
  </div>

  <div class="test-box">
    <h2>4. æŸ¥çœ‹æ‰€æœ‰ localStorage</h2>
    <button onclick="viewAllStorage()">æŸ¥çœ‹å…¨éƒ¨</button>
    <div id="all-storage"></div>
  </div>

  <script>
    // ç¯å¢ƒæ£€æŸ¥
    function checkEnvironment() {
      const status = document.getElementById('env-status');
      let html = '';

      // æ£€æŸ¥æ˜¯å¦æ— ç—•æ¨¡å¼
      const isIncognito = () => {
        return new Promise((resolve) => {
          if ('storage' in navigator && 'estimate' in navigator.storage) {
            navigator.storage.estimate().then(({ quota }) => {
              resolve(quota < 120000000); // æ— ç—•æ¨¡å¼é€šå¸¸å°äº120MB
            });
          } else {
            resolve(false);
          }
        });
      };

      isIncognito().then(incognito => {
        if (incognito) {
          html += '<div class="status warning">âš ï¸ å¯èƒ½å¤„äºæ— ç—•æ¨¡å¼ï¼æ•°æ®ä¼šåœ¨å…³é—­æ ‡ç­¾é¡µåä¸¢å¤±ã€‚</div>';
        } else {
          html += '<div class="status success">âœ… æ­£å¸¸æµè§ˆæ¨¡å¼</div>';
        }

        // æ£€æŸ¥ localStorage å¯ç”¨æ€§
        try {
          localStorage.setItem('__test__', 'test');
          localStorage.removeItem('__test__');
          html += '<div class="status success">âœ… localStorage å¯ç”¨</div>';
        } catch (e) {
          html += '<div class="status error">âŒ localStorage ä¸å¯ç”¨: ' + e.message + '</div>';
        }

        // æ˜¾ç¤ºæµè§ˆå™¨ä¿¡æ¯
        html += '<div class="status">ğŸ“± æµè§ˆå™¨: ' + navigator.userAgent + '</div>';
        html += '<div class="status">ğŸŒ å½“å‰URL: ' + window.location.href + '</div>';

        status.innerHTML = html;
      });
    }

    // æµ‹è¯• localStorage
    function testLocalStorage() {
      const result = document.getElementById('test-result');
      try {
        const testKey = 'makemyday_test';
        const testValue = {
          timestamp: new Date().toISOString(),
          data: 'This is a test',
          random: Math.random()
        };

        // ä¿å­˜
        localStorage.setItem(testKey, JSON.stringify(testValue));

        // è¯»å–
        const loaded = JSON.parse(localStorage.getItem(testKey));

        // éªŒè¯
        if (loaded.data === testValue.data) {
          result.innerHTML = '<div class="status success">âœ… localStorage è¯»å†™æµ‹è¯•é€šè¿‡ï¼</div><pre>' + JSON.stringify(loaded, null, 2) + '</pre>';
        } else {
          result.innerHTML = '<div class="status error">âŒ æ•°æ®ä¸ä¸€è‡´</div>';
        }

        // æ¸…ç†
        localStorage.removeItem(testKey);
      } catch (e) {
        result.innerHTML = '<div class="status error">âŒ æµ‹è¯•å¤±è´¥: ' + e.message + '</div>';
      }
    }

    // ä¿å­˜æµ‹è¯•æ•°æ®
    function saveTestData() {
      const result = document.getElementById('test-result');
      try {
        const testEvents = [
          {
            id: Date.now(),
            title: 'æµ‹è¯•äº‹ä»¶ ' + new Date().toLocaleTimeString(),
            priority: 'urgent-important',
            suggestion: 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•äº‹ä»¶',
            completed: false,
            createdAt: new Date().toISOString()
          }
        ];

        localStorage.setItem('makemyday_events', JSON.stringify(testEvents));
        result.innerHTML = '<div class="status success">âœ… æµ‹è¯•æ•°æ®å·²ä¿å­˜ï¼è¯·åˆ·æ–°é¡µé¢åç‚¹å‡»"åŠ è½½æµ‹è¯•æ•°æ®"æŸ¥çœ‹ã€‚</div>';
      } catch (e) {
        result.innerHTML = '<div class="status error">âŒ ä¿å­˜å¤±è´¥: ' + e.message + '</div>';
      }
    }

    // åŠ è½½æµ‹è¯•æ•°æ®
    function loadTestData() {
      const result = document.getElementById('test-result');
      try {
        const data = localStorage.getItem('makemyday_events');
        if (data) {
          const events = JSON.parse(data);
          result.innerHTML = '<div class="status success">âœ… æ‰¾åˆ° ' + events.length + ' ä¸ªäº‹ä»¶</div><pre>' + JSON.stringify(events, null, 2) + '</pre>';
        } else {
          result.innerHTML = '<div class="status warning">âš ï¸ æ²¡æœ‰æ‰¾åˆ°æ•°æ®</div>';
        }
      } catch (e) {
        result.innerHTML = '<div class="status error">âŒ åŠ è½½å¤±è´¥: ' + e.message + '</div>';
      }
    }

    // æ¸…é™¤æµ‹è¯•æ•°æ®
    function clearTestData() {
      if (confirm('ç¡®å®šæ¸…é™¤æµ‹è¯•æ•°æ®ï¼Ÿ')) {
        localStorage.removeItem('makemyday_test');
        document.getElementById('test-result').innerHTML = '<div class="status">å·²æ¸…é™¤æµ‹è¯•æ•°æ®</div>';
      }
    }

    // æŸ¥çœ‹åº”ç”¨æ•°æ®
    function viewAppData() {
      const result = document.getElementById('app-data');
      let html = '';

      const config = localStorage.getItem('makemyday_config');
      const events = localStorage.getItem('makemyday_events');

      html += '<h3>é…ç½®æ•°æ®:</h3>';
      if (config) {
        html += '<pre>' + JSON.stringify(JSON.parse(config), null, 2) + '</pre>';
      } else {
        html += '<div class="status warning">âš ï¸ æ²¡æœ‰é…ç½®æ•°æ®</div>';
      }

      html += '<h3>äº‹ä»¶æ•°æ®:</h3>';
      if (events) {
        const eventsData = JSON.parse(events);
        html += '<div class="status success">âœ… æ‰¾åˆ° ' + eventsData.length + ' ä¸ªäº‹ä»¶</div>';
        html += '<pre>' + JSON.stringify(eventsData, null, 2) + '</pre>';
      } else {
        html += '<div class="status warning">âš ï¸ æ²¡æœ‰äº‹ä»¶æ•°æ®</div>';
      }

      result.innerHTML = html;
    }

    // æ¸…é™¤åº”ç”¨æ•°æ®
    function clearAppData() {
      if (confirm('âš ï¸ ç¡®å®šæ¸…é™¤ Make My Day çš„æ‰€æœ‰æ•°æ®ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
        localStorage.removeItem('makemyday_config');
        localStorage.removeItem('makemyday_events');
        sessionStorage.removeItem('makemyday_storage_warned');
        document.getElementById('app-data').innerHTML = '<div class="status">âœ… å·²æ¸…é™¤æ‰€æœ‰åº”ç”¨æ•°æ®</div>';
      }
    }

    // æŸ¥çœ‹æ‰€æœ‰å­˜å‚¨
    function viewAllStorage() {
      const result = document.getElementById('all-storage');
      let html = '<h3>æ‰€æœ‰ localStorage é”®å€¼:</h3>';

      if (localStorage.length === 0) {
        html += '<div class="status warning">âš ï¸ localStorage ä¸ºç©º</div>';
      } else {
        html += '<div class="status">å…± ' + localStorage.length + ' é¡¹</div>';
        html += '<pre>';
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          const value = localStorage.getItem(key);
          html += key + ':\n' + value + '\n\n';
        }
        html += '</pre>';
      }

      result.innerHTML = html;
    }

    // é¡µé¢åŠ è½½æ—¶æ‰§è¡Œç¯å¢ƒæ£€æŸ¥
    checkEnvironment();
  </script>

  <div class="test-box">
    <h2>ğŸ“– ä½¿ç”¨è¯´æ˜</h2>
    <ol>
      <li>å…ˆç‚¹å‡»"æµ‹è¯• localStorage"ç¡®è®¤æµè§ˆå™¨åŠŸèƒ½æ­£å¸¸</li>
      <li>ç‚¹å‡»"ä¿å­˜æµ‹è¯•æ•°æ®"ä¿å­˜ä¸€ä¸ªæµ‹è¯•äº‹ä»¶</li>
      <li><strong>åˆ·æ–°é¡µé¢</strong> (F5 æˆ– Cmd+R)</li>
      <li>ç‚¹å‡»"åŠ è½½æµ‹è¯•æ•°æ®"æŸ¥çœ‹æ•°æ®æ˜¯å¦è¿˜åœ¨</li>
      <li>å¦‚æœæ•°æ®åœ¨ï¼Œè¯´æ˜å­˜å‚¨åŠŸèƒ½æ­£å¸¸ï¼›å¦‚æœæ•°æ®ä¸¢å¤±ï¼Œå¯èƒ½æ˜¯æµè§ˆå™¨è®¾ç½®é—®é¢˜</li>
    </ol>

    <h3>âš ï¸ å¸¸è§é—®é¢˜ï¼š</h3>
    <ul>
      <li><strong>æ— ç—•æ¨¡å¼</strong>ï¼šå…³é—­æ ‡ç­¾é¡µåæ•°æ®ä¼šä¸¢å¤± â†’ ä½¿ç”¨æ­£å¸¸æ¨¡å¼</li>
      <li><strong>æµè§ˆå™¨éšç§è®¾ç½®è¿‡é«˜</strong>ï¼šé˜»æ­¢ localStorage â†’ é™ä½éšç§çº§åˆ«</li>
      <li><strong>æµè§ˆå™¨æ‰©å±•å†²çª</strong>ï¼šæŸäº›æ‰©å±•ä¼šæ¸…ç†å­˜å‚¨ â†’ æš‚æ—¶ç¦ç”¨</li>
      <li><strong>ç£ç›˜ç©ºé—´ä¸è¶³</strong>ï¼šæ— æ³•å†™å…¥æ•°æ® â†’ æ¸…ç†ç£ç›˜ç©ºé—´</li>
    </ul>

    <p><a href="/">â† è¿”å›åº”ç”¨</a></p>
  </div>
</body>
</html>

